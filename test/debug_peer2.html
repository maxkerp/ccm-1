<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CCM Debug Peer 2</title>
  <!-- Dependencies for now -->
  <script src="./buffer.js"></script>
  <script src="../lib/ipfs-0.28.2.js"></script>
  <script src="../lib/orbitdb-0.19.7.js"></script>

  <!-- Load source files starting here -->
  <!-- <script src="../src/ccm.js"></script> -->
  <script src="../src/orbit-ccm.js"></script>
  <style>

    #container {
      width: 1300px;
      margin: auto;
    }
    #messages {
      background: black;
      color: white;
      font-size: large;
      margin-top: 20px;
      padding: 5px 0px 5px 10px;
      min-height: 200px;
      max-height: 350px;
      overflow-y: scroll;
    }

    #messages pre {
      margin: 0px;
    }

    #mocha-stats {
      position: absolute;
    }
  </style>
</head>
<body>
  <div id="container">

    <div id="content">

      <div id="messages">

      </div>

      <div id="component">
        <input id="address" type="text" placeholder="Orbit Address"/>
        <button id="replicate" type="button">Replicate</button>
      </div>

    </div>
  </div>

  <script>
    const Buffer = buffer.Buffer;
    const addressField    = document.getElementById("address")
    const replicateButton = document.getElementById("replicate")

    const putObject = function (handle) {
      // A hack to force peers to connect
      handle._node.object.put(new Buffer(JSON.stringify({ app: 'ccm.orbit.debug' })))
        .then((res) => this._ipfs.object.get(res.toJSON().multihash, { enc: 'base58' }))
        .catch((err) => logger.error(err))

    }

    const replicateStore = function () {
      if (addressField.value === '') {
        throw new Error("Can't open a store without an valid address")
      }

      CCM.Orbit.init(function (handle) {

        putObject(handle)
      })

    }

    replicateButton.addEventListener('click', replicateStore)


  </script>
</body>
</html>
