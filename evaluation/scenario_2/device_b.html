<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Scenario 2 Device B</title>
  <!-- Dependencies for now -->
  <script src="../memorySizeOfObject.js"></script>
  <script src="../../lib/ipfs-0.29.2.js"></script>
  <script src="../../lib/orbitdb-0.19.7.js"></script>

  <!-- Load source files starting here -->
  <script>
    window.LOG = "debug"
  </script>
  <script src="../../src/ccm.js"></script>
  <script src="../../src/orbit-ccm.js"></script>
  <!-- <script src="../../src/orbit-ccm-deactivated-addressstore.js"></script> -->
  <style>

    #container {
      width: 1300px;
      margin: auto;
    }
    #component {
      margin: auto;
    }

  </style>
</head>
<body>
  <div id="container">
    <div id="controls">
      <button id="replicateButton">Replicate Store</button>
      <button id="dropButton">Drop Datastore</button>
      <button id="loadButton">Get Load Time</button>
    </div>

    <div id="values">
      <p></p>
      <dl>
        <dt>Time to load store (s)</dt><dd id="loadTime"></dd>

        <dt>Approximate memory usage of store:</dt><dd id="memory"></dd>
      </dl>
    </div>

    <div id="result">
    </div>

  </div>

  <script>
    const replicateButton = document.getElementById('replicateButton'),
          dropButton      = document.getElementById('dropButton'),
          loadButton      = document.getElementById('loadButton');

    replicateButton.addEventListener('click', (e) => {
      window.START = new Date().valueOf()

      ccm.dstore('scenario_2', (store) => {
        window.END = new Date().valueOf()
        window.LOAD_TIME = (END - START) / 1000
        window.STORE = store

        result = document.getElementById('component')

        setTimeout(() => {
          document.getElementById('result').textContent = JSON.stringify(store.all(), null, 2)
        }, 5000)
      })
    })

    dropButton.addEventListener('click', (e) => {
      STORE.drop()
    })

    loadButton.addEventListener('click', (e) => {
      document.getElementById('loadTime').innerHTML = window.LOAD_TIME
      document.getElementById('memory').innerHTML   = memorySizeOf(STORE._store._oplog._entryIndex)
    })

  </script>
</body>
</html>
